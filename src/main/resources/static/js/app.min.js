var shareApp;window.addEventListener("load",()=>{const e=new ReminderApp(SF.build());Object.freeze(e),shareApp=e});const I18N={KEY_ADD_DATE:"addDate",KEY_ALWAYS_LOGIN:"alwaysLogin",KEY_ATTACH_FILE:"attachFile",KEY_COMPLETE_FLG:"completeFlg",KEY_DEL_FLG:"delFlg",KEY_NICKNAME:"nickname",KEY_PASSWORD:"password",KEY_REMINDER:"reminder",KEY_REMINDER_ID:"reminderId",KEY_REQUEST_TOKEN:"requestToken",KEY_RESTORE_TRIED:"restoreTried",KEY_RESULT_CODE:"apiResultCode",KEY_TITLE:"title",KEY_UPD_DATE:"updDate",KEY_USER_ID:"userId",API_REMINDER_LIST:"/reminder/list",API_REMINDER_REMOVE:"/reminder/remove",API_REMINDER_UPDATE:"/reminder/update",API_USER_REGISTER:"/user/register",API_USER_LOGIN:"/user/login",MSG_AJAX_FAIL:"잠시 후 다시 시도하세요",MSG_BAD_REQUEST:"정확히 입력해주세요",MSG_DEFAULT_REMINDER_TITLE:()=>"알림#"+(shareApp.reminders.length+1),MSG_FILE_TOO_BIG:"2MB 이하로 선택하세요",MSG_LOGIN_SUCCESS:"로그인 성공!",MSG_NICKNAME_EXISTS:"이미 등록된 닉네임입니다",MSG_NO_NICKNAME:"닉네임을 입력하세요",MSG_NO_PASSWORD:"비밀번호를 입력하세요",MSG_NO_TITLE:"일정 이름을 입력하세요",MSG_NOT_IMAGE:"이미지 파일을 선택하세요",MSG_REMINDER_SAVED:"일정 저장 완료",MSG_REMINDER_REMOVED:"일정 삭제 완료",MSG_TOKEN_EXPIRED:"재로그인이 필요합니다"},UI_FUNCS={GET_RGBA:e=>{let E=window.getComputedStyle(e.$||e).getPropertyValue("background-color"),t=/(\d+)\D*(\d+)\D*(\d+)\D*(\d*\.?\d*)/.exec(E);return[parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),/rgba/.test(E)?parseFloat(t[3]):1]},HIDE:e=>(e.$||e).classList.add("w3-hide"),SHOW:e=>(e.$||e).classList.remove("w3-hide"),IS_HIDDEN:e=>(e.$||e).classList.contains("w3-hide"),SHOW_SNACKBAR:(e,E,t)=>{let _=`<div id="snackbar" class="show">${e}</div>`.asSF().$;(E||document.body).append(_),setTimeout((function(){_.remove()}),t||1e3)},HIGHLIGHT:e=>{(e=e.$||e).style.animation="",setTimeout((e=>function(){e.style.animation="highlight 2s 1"})(e),139)},BRIGHT:e=>{e=e.$||e;let E=UI_FUNCS.GET_RGBA(e);e.style.backgroundColor=`rgba(${E[0]}, ${E[1]}, ${E[2]}, ${E[3]>=.5?E[3]-.5:0})`},DIM:e=>{e=e.$||e;let E=UI_FUNCS.GET_RGBA(e);e.style.backgroundColor=`rgba(${E[0]}, ${E[1]}, ${E[2]}, ${E[3]>=.5?E[3]:.5})`},CLOSE_SIDEBAR:()=>UI_FUNCS.HIDE(shareApp.sf.nav),TOGGLE_SIDEBAR:()=>UI_FUNCS.IS_HIDDEN(shareApp.sf.nav)?UI_FUNCS.SHOW(shareApp.sf.nav):UI_FUNCS.HIDE(shareApp.sf.nav)},PENDING_RESPONSE_TOKEN=new Set,API_FUNCS={REQUEST:(e,E,t)=>{if(e.addEventListener("load",(e=>function(E){if(PENDING_RESPONSE_TOKEN.clear(),200!=this.status)UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_AJAX_FAIL),e({});else{let E=JSON.parse(this.responseText),t="true"==localStorage.getItem(I18N.KEY_RESTORE_TRIED);switch(E[I18N.KEY_REQUEST_TOKEN]&&localStorage.setItem(I18N.KEY_REQUEST_TOKEN,E[I18N.KEY_REQUEST_TOKEN]),E[I18N.KEY_RESULT_CODE]){case 400:UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_BAD_REQUEST);break;case 1003:!t&&VALIDATES.STORAGE_TRUE(I18N.KEY_ALWAYS_LOGIN)?shareApp.restoreSession():(UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_TOKEN_EXPIRED),shareApp.logout());break;default:t&&localStorage.setItem(I18N.KEY_RESTORE_TRIED,"false"),e(E)}}})(t)),PENDING_RESPONSE_TOKEN.size>0)return UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_AJAX_FAIL),void t({});PENDING_RESPONSE_TOKEN.add(localStorage.getItem(I18N.KEY_REQUEST_TOKEN)),e.setRequestHeader(I18N.KEY_REQUEST_TOKEN,localStorage.getItem(I18N.KEY_REQUEST_TOKEN)),e.send(E)},REQUEST_FORM:(e,E,t)=>{let _=new XMLHttpRequest;_.open("POST",e,!0),API_FUNCS.REQUEST(_,E,t)},REQUEST_JSON:(e,E,t,_)=>{let I=new XMLHttpRequest;I.open(e,E,!0),I.setRequestHeader("Content-Type","application/json;charset=utf-8"),API_FUNCS.REQUEST(I,t&&JSON.stringify(t),_)},CALLBACK_LOGIN:e=>{switch(e[I18N.KEY_RESULT_CODE]){case 200:UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_LOGIN_SUCCESS),UI_FUNCS.HIDE(shareApp.sf.login),UI_FUNCS.SHOW(shareApp.sf.reminder),VALIDATES.STORAGE_TRUE(I18N.KEY_ALWAYS_LOGIN)&&localStorage.setItem(I18N.KEY_USER_ID,e[I18N.KEY_USER_ID]),shareApp.sf["login-nickname"].value="",shareApp.sf["login-password"].value="",API_FUNCS.REQUEST_JSON("GET",I18N.API_REMINDER_LIST,null,API_FUNCS.CALLBACK_REMINDER_LIST);break;case 1004:UI_FUNCS.HIGHLIGHT(shareApp.sf["login-nickname"]),UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_NICKNAME_EXISTS);break;default:UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_TOKEN_EXPIRED)}},CALLBACK_REMINDER_LIST:e=>{switch(e[I18N.KEY_RESULT_CODE]){case 200:shareApp.reminders.length=0,ReminderItem.sort(e.list);for(let E of e.list)new ReminderItem(E)}},CALLBACK_REMINDER_REMOVE:e=>function(E){switch(E[I18N.KEY_RESULT_CODE]){case 200:UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_REMINDER_REMOVED),e.sf.$.remove(),e[I18N.KEY_DEL_FLG]=!0}},CALLBACK_REMINDER_UPDATE:e=>function(E){switch(E[I18N.KEY_RESULT_CODE]){case 200:UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_REMINDER_SAVED),UI_FUNCS.HIGHLIGHT(e.sf),e[I18N.KEY_COMPLETE_FLG]?UI_FUNCS.DIM(e.sf):UI_FUNCS.BRIGHT(e.sf),e[I18N.KEY_REMINDER_ID]=E[I18N.KEY_REMINDER_ID],e[I18N.KEY_ATTACH_FILE]=E[I18N.KEY_ATTACH_FILE],shareApp.lastFilter.length&&shareApp.lastFilter[0]()}}},VALIDATES={STORAGE_TRUE:e=>localStorage.getItem(e)&&"true".search(localStorage.getItem(e))>=0,LOGIN_FORM:e=>e[I18N.KEY_NICKNAME]?!!e[I18N.KEY_PASSWORD]||(UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_NO_PASSWORD),UI_FUNCS.HIGHLIGHT(shareApp.sf["login-password"]),!1):(UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_NO_NICKNAME),UI_FUNCS.HIGHLIGHT(shareApp.sf["login-nickname"]),!1)};class ReminderApp{constructor(e){this.sf=e,this.lastFilter=[this.filterAllReminder],this.reminders=[],this[I18N.KEY_REMINDER]=e.asTemplate(I18N.KEY_REMINDER,document.querySelector("li[template-id=reminder]")),e.closeSidebarBtn.onclick=UI_FUNCS.CLOSE_SIDEBAR,e.toggleSidebarBtn.onclick=UI_FUNCS.TOGGLE_SIDEBAR,e.userRegisterBtn.onclick=this.register,e.userLoginBtn.onclick=this.login,e.logoutBtn.onclick=this.logout,e.newReminderBtn.onclick=this.newReinder,e.filterAllBtn.onclick=this.filterAllReminder,e.filterActiveBtn.onclick=this.filterActiveReminder,e.filterDoneBtn.onclick=this.filterDoneReminder,e.query.onkeyup=SF.debounce(this.filterQueryReminder,500),localStorage.setItem(I18N.KEY_RESTORE_TRIED,"false"),this.restoreSession()}restoreSession(){if("true"!=localStorage.getItem(I18N.KEY_RESTORE_TRIED)&&VALIDATES.STORAGE_TRUE(I18N.KEY_ALWAYS_LOGIN)){let e={};e[I18N.KEY_USER_ID]=localStorage.getItem(I18N.KEY_USER_ID),e[I18N.KEY_REQUEST_TOKEN]=localStorage.getItem(I18N.KEY_REQUEST_TOKEN),e[I18N.KEY_ALWAYS_LOGIN]=localStorage.getItem(I18N.KEY_ALWAYS_LOGIN),API_FUNCS.REQUEST_JSON("POST",I18N.API_USER_LOGIN,e,API_FUNCS.CALLBACK_LOGIN),localStorage.setItem(I18N.KEY_RESTORE_TRIED,"true")}}register(e){e&&e.preventDefault();let E=SF.formToObject(shareApp.sf.login.$);VALIDATES.LOGIN_FORM(E)&&(localStorage.setItem(I18N.KEY_ALWAYS_LOGIN,E[I18N.KEY_ALWAYS_LOGIN]),API_FUNCS.REQUEST_JSON("POST",I18N.API_USER_REGISTER,E,API_FUNCS.CALLBACK_LOGIN))}login(e){e&&e.preventDefault();let E=SF.formToObject(shareApp.sf.login.$);VALIDATES.LOGIN_FORM(E)&&(localStorage.setItem(I18N.KEY_ALWAYS_LOGIN,E[I18N.KEY_ALWAYS_LOGIN]),API_FUNCS.REQUEST_JSON("POST",I18N.API_USER_LOGIN,E,API_FUNCS.CALLBACK_LOGIN))}logout(e){e&&e.preventDefault(),UI_FUNCS.SHOW(shareApp.sf.login),UI_FUNCS.HIDE(shareApp.sf.reminder),UI_FUNCS.CLOSE_SIDEBAR(),shareApp.clearList(),localStorage.removeItem(I18N.KEY_USER_ID),localStorage.removeItem(I18N.KEY_REQUEST_TOKEN),localStorage.removeItem(I18N.KEY_ALWAYS_LOGIN),shareApp.sf["login-nickname"].value="",shareApp.sf["login-password"].value=""}newReinder(e){e&&e.preventDefault(),new ReminderItem({})}clearList(){shareApp.reminders.length=0,shareApp.sf.reminder.ul.textContent=""}filterAllReminder(e){e&&e&&e.preventDefault(),shareApp.lastFilter.length=0,shareApp.lastFilter.push(shareApp.filterAllReminder);for(let e of shareApp.reminders)UI_FUNCS.SHOW(e.sf)}filterActiveReminder(e){e&&e.preventDefault(),shareApp.lastFilter.length=0,shareApp.lastFilter.push(shareApp.filterActiveReminder);for(let e of shareApp.reminders)e[I18N.KEY_COMPLETE_FLG]?UI_FUNCS.HIDE(e.sf):UI_FUNCS.SHOW(e.sf)}filterDoneReminder(e){e&&e.preventDefault(),shareApp.lastFilter.length=0,shareApp.lastFilter.push(shareApp.filterDoneReminder);for(let e of shareApp.reminders)e[I18N.KEY_COMPLETE_FLG]?UI_FUNCS.SHOW(e.sf):UI_FUNCS.HIDE(e.sf)}filterQueryReminder(e){shareApp.lastFilter.length&&shareApp.lastFilter[0]();let E=e.target.value.toLowerCase();if(E.length<1)return!0;for(let e of shareApp.reminders)(""+e[I18N.KEY_TITLE]).toLowerCase().search(E)>=0?!UI_FUNCS.IS_HIDDEN(e.sf)&&UI_FUNCS.SHOW(e.sf):UI_FUNCS.HIDE(e.sf);return!0}}Object.freeze(ReminderApp);class ReminderItem{constructor(e){var E,t;this[I18N.KEY_REMINDER_ID]=e[I18N.KEY_REMINDER_ID]||null,this[I18N.KEY_TITLE]=e[I18N.KEY_TITLE]||I18N.MSG_DEFAULT_REMINDER_TITLE(),this[I18N.KEY_ATTACH_FILE]=e[I18N.KEY_ATTACH_FILE],this[I18N.KEY_COMPLETE_FLG]=Boolean(e[I18N.KEY_COMPLETE_FLG]),this[I18N.KEY_DEL_FLG]=!1,shareApp.reminders.push(this),this.sf=shareApp[I18N.KEY_REMINDER](),shareApp.sf.reminder.ul.$.append(this.sf.$),this.sf[`[name=${I18N.KEY_TITLE}]`].value=this[I18N.KEY_TITLE],this.sf[`[name=${I18N.KEY_TITLE}]`].onkeydown=(E=this,function(e){return 13!=e.keyCode||(e.stopPropagation(),E.update(),!1)}),this.sf.img.$.style.maxWidth=this.sf.img.parentElement.clientWidth+"px",this.sf.img.$.style.maxHeight=window.innerHeight/5+"px",this[I18N.KEY_ATTACH_FILE]?(this.sf["button.no-img-btn"].$.remove(),this.sf.img.src=this[I18N.KEY_ATTACH_FILE]):(this.sf["button.no-img-btn"].onclick=(t=this.sf[`[name=${I18N.KEY_ATTACH_FILE}]`].$,function(e){e.preventDefault(),t.click()}),this.sf[`[name=${I18N.KEY_ATTACH_FILE}]`].onchange=(e=>function(E){if(E.stopPropagation(),E.target.files.length<1)return!1;let t=E.target.files[0];return/image/.test(t.type)?t.size>2097152?(UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_FILE_TOO_BIG),!1):(e[I18N.KEY_ATTACH_FILE]=t,e.sf.img.src=URL.createObjectURL(t),e.update(),UI_FUNCS.HIDE(e.sf["button.no-img-btn"]),!1):(UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_NOT_IMAGE),!1)})(this)),(this.sf[`[name=${I18N.KEY_COMPLETE_FLG}]`].checked=this[I18N.KEY_COMPLETE_FLG])&&UI_FUNCS.DIM(this.sf),this.sf["button.remove-btn"].onclick=(e=>function(E){E.preventDefault(),e.remove()})(this);for(let e of this.sf.form.$.querySelectorAll("input:not([type=file]),select,textarea")){let E=SF.debounce(SF.observeForm(this.sf.form.$,(e=>function(E,t,_){e.update()})(this)),300);e.addEventListener("change",E)}}static sort(e){e.sort((e,E)=>{let t=e[I18N.KEY_REMINDER_ID],_=E[I18N.KEY_REMINDER_ID];return t||_?t?_?t.length<_.length?-1:t.length>_.length?1:t.localeCompare(_):-1:1:0})}update(){let e=SF.formToObject(this.sf.form.$),E=""+e[I18N.KEY_TITLE];if(E.replace(/\s/g,"").length<1)return void UI_FUNCS.SHOW_SNACKBAR(I18N.MSG_NO_TITLE);let t=new FormData;t.set(I18N.KEY_TITLE,this[I18N.KEY_TITLE]=E),t.set(I18N.KEY_COMPLETE_FLG,this[I18N.KEY_COMPLETE_FLG]=Boolean(e[I18N.KEY_COMPLETE_FLG])),this[I18N.KEY_REMINDER_ID]&&t.set(I18N.KEY_REMINDER_ID,this[I18N.KEY_REMINDER_ID]),"string"!=typeof this[I18N.KEY_ATTACH_FILE]&&t.set(I18N.KEY_ATTACH_FILE,this[I18N.KEY_ATTACH_FILE]),API_FUNCS.REQUEST_FORM(I18N.API_REMINDER_UPDATE,t,API_FUNCS.CALLBACK_REMINDER_UPDATE(this))}remove(){if(this[I18N.KEY_REMINDER_ID]){let e={};e[I18N.KEY_REMINDER_ID]=this[I18N.KEY_REMINDER_ID],API_FUNCS.REQUEST_JSON("POST",I18N.API_REMINDER_REMOVE,e,API_FUNCS.CALLBACK_REMINDER_REMOVE(this))}else this.sf.$.remove(),this[I18N.KEY_DEL_FLG]=!0}}Object.freeze(ReminderItem);